# using global variables
import paystack  # noqa: IMP101
from paystack._base_address import BaseAddresses

from typing import Optional


class RequestorOptions(object):
    api_key: Optional[str]
    paystack_account: Optional[str]
    paystack_context: Optional[str]
    paystack_version: Optional[str]
    base_addresses: BaseAddresses
    max_network_retries: Optional[int]

    def __init__(
        self,
        api_key: Optional[str] = None,
        paystack_account: Optional[str] = None,
        paystack_context: Optional[str] = None,
        paystack_version: Optional[str] = None,
        base_addresses: BaseAddresses = {},
        max_network_retries: Optional[int] = None,
    ):
        self.api_key = api_key
        self.paystack_account = paystack_account
        self.paystack_context = paystack_context
        self.paystack_version = paystack_version
        self.base_addresses = {}

        # Base addresses can be unset (for correct merging).
        # If they are not set, then we will use default API bases defined on paystack.
        if base_addresses.get("api"):
            self.base_addresses["api"] = base_addresses.get("api")
        if base_addresses.get("connect") is not None:
            self.base_addresses["connect"] = base_addresses.get("connect")
        if base_addresses.get("files") is not None:
            self.base_addresses["files"] = base_addresses.get("files")
        if base_addresses.get("meter_events") is not None:
            self.base_addresses["meter_events"] = base_addresses.get(
                "meter_events"
            )

        self.max_network_retries = max_network_retries

    def to_dict(self):
        """
        Returns a dict representation of the object.
        """
        return {
            "api_key": self.api_key,
            "paystack_account": self.paystack_account,
            "paystack_context": self.paystack_context,
            "paystack_version": self.paystack_version,
            "base_addresses": self.base_addresses,
            "max_network_retries": self.max_network_retries,
        }


class _GlobalRequestorOptions(RequestorOptions):
    def __init__(self):
        pass

    @property
    def base_addresses(self):
        return {
            "api": paystack.api_base,
            "connect": paystack.connect_api_base,
            "files": paystack.upload_api_base,
            "meter_events": paystack.meter_events_api_base,
        }

    @property
    def api_key(self):
        return paystack.api_key

    @property
    def paystack_version(self):
        return paystack.api_version

    @property
    def paystack_account(self):
        return None

    @property
    def paystack_context(self):
        return None

    @property
    def max_network_retries(self):
        return paystack.max_network_retries
